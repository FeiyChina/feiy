<% if @organization.photo %>
  <div class="org-show-banner">
    <%= cl_image_tag @organization.photo.path, width: 1440, height: 450, crop: :fill %>
  </div>
<% else %>
  <div class="org-show-grey-banner"></div>
<% end %>

<div class="org-show-banner-logo-placeholder">
  <div class="round-logo-placeholder">
    <% if @organization.logo? %>
        <%= cl_image_tag @organization.logo.path, width: 100, height: 100, crop: :fill, radius: :max %>
    <% end %>
  </div>
</div>

<div class="org-show-banner-content">
  <div class="org-show-banner-content-info">
    <h1><%= @organization.name.capitalize %></h1>
    <p><strong>Category:</strong> <%= @organization.category.capitalize %></p>
    <p><strong><%= @organization.votes_for.size %> Likes</strong></p>
  </div>
  <% if user_signed_in? && @organization.user_id == current_user.id %>
    <div class="org-show-button-holder">
      <%= link_to edit_organization_path(@organization), method: :get do %>
        <%= image_tag "editor.png", class: "org-show-update" %>
      <% end %>
      <%= link_to organization_organization_contact_path(@organization) do %>
        <%= image_tag "mail.png", class: "org-show-update" %>
      <% end %>
      <% if user_signed_in? %>
        <div class="action-like ">
          <%= link_to like_organization_path(@organization), method: :post do %>
            <%= image_tag "praise.png", class: "org-show-update" %>
          <% end %>
        </div>
      <% else %>
        <div class="action-like ">
          <%= link_to new_user_session_path do %>
            <%= image_tag "praise.png", class: "org-show-update" %>
          <% end %>
        </div>
      <% end %>
    </div>
  <% end %>
</div>


<div class="org-show-body-content">
  <h4><strong>Who were are?</strong></h4>
  <p><%= @organization.description %></p>
  <h4><strong>What problem we solve?</strong></h4>
  <p><%= @organization.problem %></p>
  <h4><strong>Where we are?</strong></h4>
  <p><%= @organization.address %></p>
</div>

<!-- comment function -->
<div class="org-show-comment-section">
  <h3 id="leavemsg">Leave us a nice comment</h3>
  <div class="org-show-comment-box">
    <%= form_tag create_comment_path, method: "post" do %>
    <%= hidden_field_tag "id", @organization.id %>
    <%= text_area_tag :comment %>
    <div class="comment-btn">
      <%= submit_tag "Submit", class: "btn btn-success" %>
    </div>
    <% end %>
  </div>
</div>

<% if @organization.comments %>
  <!-- comment list -->
  <div class="org-show-comment-big-card">
    <% @organization.comments.each do |comment| %>
      <div class="random-comment-big-card-top">
        <div class="comment-big-card-useravatar">
          <% if comment.user.avatar? %>
            <%= cl_image_tag comment.user.avatar.path, height: 50, width: 50, crop: :thumb, gravity: :face, dpr: 2.0, class: "avatar-style" %>
          <% else %>
            <%= image_tag "profile_placeholder.png", style: "width: 50px" %>
          <% end %>
        </div>
        <div class="comment-big-card-userinfo">
          <% if comment.user.name? %>
            <p class="comment-email"><strong><%= comment.user.name %></strong></p>
          <% else %>
            <p class="comment-email">Anonimous</p>
          <% end %>
        </div>
      </div>
      <div class="random-comment-big-card-bottom">
        <em><%= comment.comment %></em>
      </div>
      <div class="line"></div>
    <% end %>
  </div>
<% end %>

<!-- Jobs Section -->
<div class="title-divider text-center" id="title-padding">
  <h4>JOBS</h4>
</div>

<div class="text-center">
  <% if user_signed_in? && @organization.user_id == current_user.id %>
  <div class="container text-center">
    <%= link_to "Add a job", new_organization_job_path(@organization), method: :get, class: 'btn-feiy-secondary'  %>
  </div>
  <% end %>
</div>
<div class="container">
  <div class="row">
    <% @organization.jobs.each do |job| %>
      <div class="col-xs-12 col-sm-6 col-md-4">
          <div class="job-card">
          <% if job.organization.logo %>
            <img src="<%= cl_image_path job.organization.logo.path, height: 180, width: 350, crop: :fill%>", class='job-card-img' >
          <% else %>
            <%= image_tag "card_org_ngo_default.jpg", class: "job-card-img" %>
          <% end %>
          <div class="job-card-description">
            <p id="job-name"><strong><%= truncate(job.name, length: 20) %></strong></p>
            <p id="job-problem"><%= truncate(job.organization.name, length: 20) %></p>
            <p id="job-category"><%= truncate(job.job_type, length: 20) %></p>
            <p id="job-category"><%= truncate(job.address, length: 20) %></p>
          </div>
           <%= link_to "", organization_job_path(job.organization_id, job.id) , class: "organization-card-link" %>
          </div>
      </div>
    <% end %>
  </div>
</div>

<div class="title-divider text-center" id="title-padding">
  <h4>EVENTS</h4>
</div>

<!-- Hardcoded Events Section -->
<div class="text-center">
    <% if user_signed_in? && @organization.user_id == current_user.id %>
  <div class="container text-center">
    <%= link_to "Add a event", new_organization_event_path(@organization), method: :get, class: 'btn-feiy-secondary'  %>
  </div>
  <% end %>
</div>
<div class="container">
  <div class="row">
    <% @events.each do |event| %>
      <div class="col-xs-12 col-sm-6 col-md-4">
        <div class="event-card">
        <% if event.organization.logo %>
          <img src="<%= cl_image_path event.organization.logo.path, height: 180, width: 350, crop: :fill%>", class='events-card-img' >
        <% else %>
          <%= image_tag "card_org_ngo_default.jpg", class: "events-card-img" %>
        <% end %>
          <div class="events-card-description">
            <p id="job-problem"><strong><%= truncate(event.name, length: 20) %></strong></p>
            <p id="job-address"><%= event.date.strftime("%B %e, %Y, %l:%M %p ") %></p>
          </div>
          <p class="event-hover-card text-center" id="event-name">Hosted by <%= event.organization.name %><br><br><%= truncate(event.content, length: 20)%></p>
          <%= link_to "", organization_event_path(event.organization_id, event.id), class: "organization-card-link" %>
        </div>
      </div>
    <% end %>
  </div>
</div>

<!-- OTHER ORGANIZATIONS -->

<% if @suggested_organizations_shuffled.empty? %>
  <div></div>
<% else %>
  <div class="title-divider text-center" id="title-padding">
    <h4>ORGANIZATIONS YOU MAY LIKE</h4>
  </div>
  <div class="container">
    <div class="row">
      <% @suggested_organizations_shuffled.each do |organization| %>
        <div class="col-xs-12 col-sm-6 col-md-4">
          <div class="organization-card">
          <% if organization.photo %>
            <img src="<%= cl_image_path organization.photo.path, height: 180, width: 350, crop: :fill%>", class='organization-card-img' >
          <% else %>
            <%= image_tag "card_org_ngo_default.jpg", class: "organization-card-img" %>
          <% end %>
          <div class="organization-card-description">
            <p id="organization-name"><strong><%= truncate(organization.name, length: 20) %></strong></p>
            <p id="organization-problem"><%= truncate(organization.problem, length: 20) %></p>
            <% if organization.category %>
              <p id="organization-category"><%= truncate(organization.category, length: 20) %></p>
            <% end %>
          </div>
          <div class="organization-card-icons">
            <i class="fa fa-thumbs-up organization-card-icon"></i>
            <span class="organization-card-icon-text"><%= organization.votes_for.size %></span>
          </div>
          <%= link_to "", organization_path(organization), class: "organization-card-link" %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
<% end %>

<% if @organization.votes_for.count == 0 %>
  <div></div>
<% else %>
  <div class="title-divider text-center" id="title-padding">
    <h4>FOLLOWERS</h4>
  </div>
  <div class="container">
    <div class="row" style="margin-top: 20px;">
      <% @organization.votes_for.each do |follower| %>
        <div class="col-xs-12 col-sm-6 col-md-4">
          <div class="follower-card">
            <div class="follower-card-avatar">
              <% if follower.voter.avatar? %>
                <%= cl_image_tag follower.voter.avatar.path, height: 50, width: 50, crop: :fill, gravity: :face, radius: :max, class: "avatar-style" %>
              <% else %>
                <%= image_tag "profile_placeholder.png", style: "width: 50px" %>
              <% end %>
            </div>
            <div class="follower-card-info">
              <p class="comment-email"><strong><%= follower.voter.name %></strong></p>
              <p class="comment-date"><%= follower.voter.created_at.strftime("%B %d, %Y") %></p>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
<% end %>


